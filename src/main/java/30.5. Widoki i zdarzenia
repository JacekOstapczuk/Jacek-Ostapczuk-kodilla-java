CREATE TABLE STATS (
                       STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
                       STAT_DATE DATETIME NOT NULL,
                       STAT VARCHAR(20) NOT NULL,
                       VALUE INT(11) NOT NULL
);



CREATE VIEW BESTSELLERS_COUNT AS

SELECT COUNT(*) FROM BOOKS
WHERE BESTSELLER >0;




USE KODILLA_COURSE;

DELIMITER $$

CREATE EVENT UPDATE_BESTSELLERS_STAT

    ON SCHEDULE EVERY 1 MINUTE
    DO
    BEGIN
        DECLARE BESTSELLER_AMOUNT INT(5);
    CALL UpdateBestSellers();

 SELECT  * FROM  BESTSELLERS_COUNT
INTO BESTSELLER_AMOUNT;

INSERT INTO STATS ( STAT_DATE, STAT, VALUE )
VALUE  (CURDATE(), 'BESTSELLER', BESTSELLER_AMOUNT );

END $$
DELIMITER ;